<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="favicon.ico" type="image/ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCL Appliances - Task Management System</title>
    <link rel="stylesheet" href="TCLstyles.css">
</head>
<body>
    <header>
        <div class="logo" id="tcl">TCL SUN INC. E-commerce Department</div>
        <h3 id='user'> Welcome, </h3>
        <script>
            user = document.getElementById('user')

            
        </script>
        <nav>
            <ul>
                <button id="btns" onclick="Dashboard()">Dashboard</button>
                <button id="btns" onclick="Creative()">Creative Asset Tracker</button>
                <button id="btns" onclick="Calendar()">Calendar</button>
                <button id="btns" onclick="Leave()">Digital Marketing</button>
                <button id="btns" onclick="Payout()">Payout Tracker</button>
                <button id="btns" onclick="Customer()">Customer Service</button>
            </ul>
        </nav>
    </header>
 
    <main>
        <section class="dashboard">
            <h1>Welcome to the Task Management System</h1>
            <div class="task-card">
    <h2 id="upcoming">Upcoming Tasks</h2>
    <button id="archivetask" onclick="archive()">Task Archive</button>
    <button id="task" onclick="addtask()">Add Task</button>
    <ul id="taskbox">
    </ul>
</div>

<div class="calendar-card">
    <h2 id="upcoming1">Personal Tasks </h2>
    <ul id="taskbox1">
    </ul>
</div>
<script>
    async function fetch_personal(){
        const res = await fetch('/api/personal')
        const data = await res.json()

        for (let index = 0; index < data.length; index++) {
                const newli = document.createElement('li')
                const taskbox = document.getElementById('taskbox1')

                newli.id = 'tasks'
                newli.className = 'task-item'
                newli.textContent = `Task ${index+1} - ${data[index].task}, ${(data[index].deadline.slice(0,-14))}`

                taskbox.append(newli)

                document.querySelectorAll('.task-item').forEach(item => {
                item.addEventListener('click', () => {
                    currentTask = item;
                    input.value = item.textContent.slice(0, -12);
                    modal.style.display = 'block';
                    cripply.textContent = 'Edit Task';
                    saveBtn.textContent = 'Save';
                    doneTask.style.display = 'inline-flex';
                    del.style.display = 'inline-flex';
                    console.log(item.textContent.slice(9, -12))
                    taskdate.value = item.textContent.slice(-10)
                    for (let index1 = 0; index1 < data.length; index1++) {
                        if(data[index1].task == item.textContent.slice(9, -12)){
                            console.log(data[index1])
                            assigned.value = data[index1].assigned
                            note.value = data[index1].note
                        }
                    }
                });
            });
        }

    }

    fetch_personal()

</script>


<!-- Edit-Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="cripply">Edit Task</h3>
        <form action="" method="post" id="create_update">
    <input name="task" type="text" id="taskText" placeholder="Task" required>
    <input name="deadline" type="date" id="task-date" placeholder="Deadline" required>
    <input type="checkbox" name="live" id="livecheck">
    <input name="note" type="text" id="note" placeholder="Notes for Employee">
    <select name="assigned" id="assigned">
        <option value="">Select Role</option>
        <option value="Head of Ecommerce Manager">Head of Ecommerce Manager</option>
        <option value="Ecommerce Supervisor">Ecommerce Supervisor</option>
        <option value="TikTok Operator">TikTok Operator</option>
        <option value="Sales Channel Operators">Sales Channel Operators</option>
        <option value="Shopee Operator">Shopee Operator</option>
        <option value="Lazada Operator">Lazada Operator</option>
        <option value="Digital Marketing">Digital Marketing</option>
        <option value="Graphic Artists">Graphic Artists</option>
        <option value="Customer Service">Customer Service</option>
        <option value="Live Hosts">Live Hosts</option>
        <!-- Add more employees as needed -->
    </select> 
    
</form>

        <button id="saveTask" onclick="save()">Save</button>
        <button id="doneTask" onclick="done()">Task done</button> <!-- remove task and redirect to archive-->
        <button id="del" onclick="delete_task()">Delete</button> 
    </div>
</div>

<!-- ARCHIVE MODAL-->
<div id="archiveModal" class="modal1">
    <div class="modal-content1">
        <span class="close1" id="close1">&times;</span>
        <h3 id="task_archive1">Task Archived</h3>
        <form action="" method="post">
        <ul id="ularchives">
            <li id="fixed">
                <span>
                    Task Name
                </span>
                <span>
                    Status
                </span>
                <span>
                    Date Modified
                </span>
            </li>
        </ul>
        </form>
    </div>
</div>

<!-- EDIT ARCHIVE -->
<div id="archive" class="archive">
    <ul>
        <li>
            <h3>Modify Archive?</h3>
            <span class="exitmodal" id="exitmodal">x</span>
        </li>
        <li>
            <form action="" method="post" id="delete_restore">
            <input name="task" type="text" id="archivetext" placeholder="Task" readonly>
            <input name="deadline" type="date" id="archivedate" placeholder="Deadline" readonly>
            </form>
        </li>
        <li>
            <button onclick="delete_archive()">Delete</button>
            <button onclick="restore_archive()">Restore</button>
        </li>
    </ul>
</div>



        </section>
    </main>

    <footer>
         <a href="index.html"> <img src="logout.png" height="50px" id="logoutICON" align="left"> </a>
        <Br>
        <p>&copy; 2025 TCL Appliances | All Rights Reserved</p>
    </footer>
    
    <script src="scripts.js"></script>


    <script>

    function Dashboard(){
        location.href = '/TCL_index.html'
    }

    function Creative(){
        location.href = '/TCL_creative.html'
    }

    function Calendar(){
        location.href = '/TCLcalendar.html'
    }

    function Leave(){
        location.href = '/digitalmarket.html'
    }

    function Payout(){
        location.href = '/TCLpayout.html'
    }

    function Customer(){
        location.href = '/TCLcsr.html'
    }

    fetch_data()

    const saveBtn = document.getElementById('saveTask')
    const modal = document.getElementById('editModal');
    const closeModal = document.querySelector('.close');
    const input = document.getElementById('taskText');
    const doneTask = document.getElementById('doneTask')
    const del = document.getElementById('del')
    const taskdate = document.getElementById('task-date')
    let currentTask = null;
    const archiveModal = document.getElementById('archiveModal')
    const close1 = document.getElementById('close1')
    const exitmodal = document.getElementById('exitmodal')
    const archives = document.getElementById('archive')
    const livecheck = document.getElementById('livecheck')
    const create_update = document.getElementById('create_update')
    const archivedate = document.getElementById('archivedate')
    const archivetext = document.getElementById('archivetext')
    const ularchives = document.getElementById('ularchives')
    const note = document.getElementById('note')
    const assigned = document.getElementById('assigned')


    const cripply = document.getElementById('cripply')

    async function currentuser(){
        const res = await fetch('/current_user')
        const data = await res.json()

        if(data.current_user == undefined){
            window.location.href = 'index.html'
        }

        console.log(data)
        user.textContent += data.current_user

    }

    currentuser()

    async function restore_archive(){
        const res = await fetch('/api/archive/TCL.html')
        const data1 = await res.json()
        let dataNote = ''
        let dataAssigned = ''

        for (let index = 0; index < data1.length; index++) {
            if(data1[index].task == archivetext.value){
                console.log(data1[index])
                dataNote = data1[index].note
                dataAssigned = data1[index].assigned
            }
            
        }

        task_name = archivetext.value
        task_date = archivedate.value

        data = {
            task: task_name,
            date: task_date,
            note: dataNote,
            assigned: dataAssigned
        }

        jsonData = JSON.stringify(data)

        xhr = new XMLHttpRequest()
        xhr.open("POST", "http://localhost:5000/api/restore_archive/TCL.html", true)
        xhr.setRequestHeader("Content-type", "application/json")
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200){
                console.log('Data Sent Successfully')
            }
        }

        xhr.send(jsonData)
        location.reload()
    }

    async function delete_archive(){
        task_name = archivetext.value
        console.log(task_name)

        data = {
            task: task_name,
        }

        jsonData = JSON.stringify(data)

        xhr = new XMLHttpRequest()
        xhr.open("POST", "http://localhost:5000/api/delete_archive/TCL.html", true)
        xhr.setRequestHeader("Content-type", "application/json")
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200){
                console.log('Data Sent Successfully')
            }
        }

        xhr.send(jsonData)
        location.reload()
    
    }

    async function delete_task() {
        task_name = input.value
        task_date = taskdate.value

        data = {
            task: task_name,
            date: task_date,
            status: 'Deleted',
            note: note.value,
            assigned: assigned.value
        }

        jsonData = JSON.stringify(data)

        xhr = new XMLHttpRequest()
        xhr.open("POST", "http://localhost:5000/api/delete_task/TCL.html", true)
        xhr.setRequestHeader("Content-type", "application/json")
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200){
                console.log('Data Sent Successfully')
            }
        }

        xhr.send(jsonData)
        location.reload()
    }

    async function done() {
        task_name = input.value
        task_date = taskdate.value

        data = {
            task: task_name,
            date: task_date,
            status: 'Done',
            note: note.value,
            assigned: assigned.value
        }

        jsonData = JSON.stringify(data)

        xhr = new XMLHttpRequest()
        xhr.open("POST", "http://localhost:5000/api/done_task/TCL.html", true)
        xhr.setRequestHeader("Content-type", "application/json")
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200){
                console.log('Data Sent Successfully')
            }
        }

        xhr.send(jsonData)
        location.reload()
    }

    async function save(){
        console.log(saveBtn.textContent)

        if (saveBtn.textContent == 'Save'){
            task_name = input.value
            task_date = taskdate.value
            task_note = note.value
            task_assigned = assigned.value

            data = {
                task: task_name,
                deadline: task_date,
                note: task_note,
                assigned: task_assigned
            }

            jsonData = JSON.stringify(data)

            xhr = new XMLHttpRequest()
            xhr.open("POST", "http://localhost:5000/api/update_task/TCL.html", true)
            xhr.setRequestHeader("Content-type", "application/json")
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200){
                    console.log('Data Sent Successfully')
                }
            }

            xhr.send(jsonData)
            location.reload()
        }

        else if (saveBtn.textContent == 'Add Task'){
            task_name = input.value
            task_date = taskdate.value
            task_note = note.value
            task_assigned = assigned.value

            data = {
                task: task_name,
                deadline: task_date,
                note: task_note,
                assigned: task_assigned
            }

            jsonData = JSON.stringify(data)

            xhr = new XMLHttpRequest()
            xhr.open("POST", "http://localhost:5000/insert_task/TCL.html", true)
            xhr.setRequestHeader("Content-type", "application/json")
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200){
                    console.log('Data Sent Successfully')
                }
            }

            xhr.send(jsonData)
            location.reload()
        }
        
    }

    exitmodal.addEventListener('click', ()=>{
        archives.style.display = 'none'
    })

    async function fetch_archive(){
        try{
            const response = await fetch('/api/archive/TCL.html')
            const data = await response.json()

            for (let index = 0; index < data.length; index++) {
                const newli1 = document.createElement('li')
                const span1 = document.createElement('span')
                const span2 = document.createElement('span')
                const span3 = document.createElement('span')

                span1.textContent = data[index].task
                span2.textContent = data[index].status
                span3.textContent = data[index].date

                ularchives.append(newli1)
                newli1.append(span1)
                newli1.append(span2)
                newli1.append(span3)

                newli1.id = 'taskarchive'
                span1.id = 'taskname'
                span2.id = 'taskstatus'
                span3.id = 'taskmodified'

                document.querySelectorAll('#taskarchive').forEach(item => item.addEventListener('click', ()=>{
                archives.style.display = 'inline-flex'
                archivetext.value = item.childNodes[0].textContent
                archivedate.value = `${item.childNodes[2].textContent.slice(0, 10)}`
            }))

            }
        }
        catch(err){
            console.error(err)
        }
    }

    fetch_archive()

    function archive(){
        archiveModal.style.display = 'inline-flex'
    }

    close1.addEventListener('click', ()=>{
        archiveModal.style.display = 'none'
    })

    function addtask(){
        modal.style.display = 'block';
        saveBtn.textContent = 'Add Task';
        cripply.textContent = 'Add Task';
        doneTask.style.display = 'none';
        del.style.display = 'none'
        taskdate.value = ''
        input.value = ''
        note.value = ''
        assigned.value = ''
        livecheck.checked = false
        create_update.action = '/insert_task/TCL.html'
    }

    closeModal.onclick = function() {
        modal.style.display = 'none';
    }

    window.onclick = function(e) {
        if (e.target == modal) {
            modal.style.display = 'none';
        }
    }

    async function fetch_data() {
        try{
            const response = await fetch('/api/TCL_index.html')
            const data = await response.json()

            if(!response.ok){
                console.log('no resources')
            }

            for (let index = 0; index < data.length; index++) {
                const newli = document.createElement('li')
                const taskbox = document.getElementById('taskbox')

                newli.id = 'tasks'
                newli.className = 'task-item'
                newli.textContent = `Task ${index+1} - ${data[index].task}, ${(data[index].deadline.slice(0,-14))}`

                taskbox.append(newli)

                document.querySelectorAll('.task-item').forEach(item => {
                item.addEventListener('click', () => {
                    currentTask = item;
                    input.value = item.textContent.slice(0, -12);
                    modal.style.display = 'block';
                    cripply.textContent = 'Edit Task';
                    saveBtn.textContent = 'Save';
                    doneTask.style.display = 'inline-flex';
                    del.style.display = 'inline-flex';
                    console.log(item.textContent.slice(9, -12))
                    taskdate.value = item.textContent.slice(-10)
                    for (let index1 = 0; index1 < data.length; index1++) {
                        if(data[index1].task == item.textContent.slice(9, -12)){
                            console.log(data[index1])
                            assigned.value = data[index1].assigned
                            note.value = data[index1].note
                        }
                    }
                });
            });
            }
        }
        catch(err){
            console.error(err)
        }
    }
    
</script>

</body>
</html>
